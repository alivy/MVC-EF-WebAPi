2013-09-10 10:23:39,285 [7484] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 10:23:39,320 [7484] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 10:23:39,326 [7484] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 10:23:39,327 [7484] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 10:24:04,388 [10860] DEBUG Servicesys_user - 获取实体对象
2013-09-10 10:24:04,411 [10860] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'lhs'and Password =  'lhs'and IsEnable =  'True'
2013-09-10 10:24:04,527 [10860] DEBUG Sys - 
update sys_user
set LoginCount = isnull(LoginCount,0) + 1
   ,LastLoginDate = getdate()
where UserCode = 'lhs' 
2013-09-10 10:24:04,614 [10860] DEBUG Sys - insert into sys_loginHistory([UserCode],[UserName],[HostName],[HostIP],[LoginCity],[LoginDate]) values('lhs','刘会胜','LHS-PC','ILData[0]/localhost','福建省厦门市','2013-09-10 10:24:04')
2013-09-10 10:24:04,618 [10860] DEBUG Servicemms_project - 获取实体对象
2013-09-10 10:24:04,618 [10860] DEBUG Mms - select mms_project.* from mms_project where  ProjectCode =  '201306030001'
2013-09-10 10:24:04,789 [8612] DEBUG Sys - select * from sys_userSetting where UserCode='lhs'
2013-09-10 10:24:08,140 [11960] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'lhs' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'lhs'
  )  
)
order by B.MenuSeq,B.MenuCode
2013-09-10 10:24:10,955 [10308] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Sys/generator/Index','/Sys/generator')
2013-09-10 10:24:15,980 [10860] DEBUG Mms - SELECT Name as TableName FROM sys.tables order by Name
2013-09-10 10:24:15,987 [11960] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('undefined')
ORDER BY sys.columns.column_id
2013-09-10 10:24:16,815 [10180] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_direct')
ORDER BY sys.columns.column_id
2013-09-10 10:24:22,931 [10860] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_direct')
ORDER BY sys.columns.column_id
2013-09-10 10:24:24,447 [10056] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_directDetail')
ORDER BY sys.columns.column_id
2013-09-10 10:24:27,458 [10056] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_direct')
ORDER BY sys.columns.column_id
2013-09-10 10:24:30,061 [10056] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_directDetail')
ORDER BY sys.columns.column_id
2013-09-10 10:27:34,971 [10152] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_direct')
ORDER BY sys.columns.column_id
2013-09-10 10:27:35,786 [10152] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_directDetail')
ORDER BY sys.columns.column_id
2013-09-10 11:23:15,944 [12736] DEBUG Servicesys_user - 获取实体对象
2013-09-10 11:23:15,950 [12736] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'lhs'and Password =  'lhs'and IsEnable =  'True'
2013-09-10 11:23:15,951 [12736] DEBUG Sys - 
update sys_user
set LoginCount = isnull(LoginCount,0) + 1
   ,LastLoginDate = getdate()
where UserCode = 'lhs' 
2013-09-10 11:23:15,957 [12736] DEBUG Sys - insert into sys_loginHistory([UserCode],[UserName],[HostName],[HostIP],[LoginCity],[LoginDate]) values('lhs','刘会胜','LHS-PC','ILData[0]/localhost','福建省厦门市','2013-09-10 11:23:15')
2013-09-10 11:23:15,958 [12736] DEBUG Servicemms_project - 获取实体对象
2013-09-10 11:23:15,963 [12736] DEBUG Mms - select mms_project.* from mms_project where  ProjectCode =  '201306030001'
2013-09-10 11:23:15,986 [2600] DEBUG Sys - select * from sys_userSetting where UserCode='lhs'
2013-09-10 11:23:16,269 [6756] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'lhs' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'lhs'
  )  
)
order by B.MenuSeq,B.MenuCode
2013-09-10 11:23:18,828 [11276] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Sys/generator/Index','/Sys/generator')
2013-09-10 11:23:26,288 [4120] DEBUG Mms - SELECT Name as TableName FROM sys.tables order by Name
2013-09-10 11:23:26,320 [12460] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('undefined')
ORDER BY sys.columns.column_id
2013-09-10 11:23:28,388 [4120] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('test_liy')
ORDER BY sys.columns.column_id
2013-09-10 11:27:17,758 [6756] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('test_liy')
ORDER BY sys.columns.column_id
2013-09-10 11:27:17,772 [6756] DEBUG Mms - sp_pkeys 'test_liy'
2013-09-10 11:30:07,104 [7484] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 11:30:07,135 [7484] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 11:30:07,141 [7484] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 11:30:07,142 [7484] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 11:30:14,806 [7484] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 11:30:14,839 [7484] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 11:30:14,846 [7484] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 11:30:14,846 [7484] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2013-09-10 11:30:20,623 [10300] DEBUG Servicesys_user - 获取实体对象
2013-09-10 11:30:20,639 [10300] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'lhs'and Password =  'lhs'and IsEnable =  'True'
2013-09-10 11:30:20,708 [10300] DEBUG Sys - 
update sys_user
set LoginCount = isnull(LoginCount,0) + 1
   ,LastLoginDate = getdate()
where UserCode = 'lhs' 
2013-09-10 11:30:20,750 [10300] DEBUG Sys - insert into sys_loginHistory([UserCode],[UserName],[HostName],[HostIP],[LoginCity],[LoginDate]) values('lhs','刘会胜','LHS-PC','ILData[0]/localhost','福建省厦门市','2013-09-10 11:30:20')
2013-09-10 11:30:20,753 [10300] DEBUG Servicemms_project - 获取实体对象
2013-09-10 11:30:20,754 [10300] DEBUG Mms - select mms_project.* from mms_project where  ProjectCode =  '201306030001'
2013-09-10 11:30:21,113 [5744] DEBUG Sys - select * from sys_userSetting where UserCode='lhs'
2013-09-10 11:30:25,602 [12108] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'lhs' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'lhs'
  )  
)
order by B.MenuSeq,B.MenuCode
2013-09-10 11:30:28,443 [9264] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Sys/menu/Index','/Sys/menu')
2013-09-10 11:30:30,365 [11832] DEBUG Servicesys_menu - 获取动态列表
2013-09-10 11:30:30,367 [11832] DEBUG Sys - select A.*,B.MenuName as ParentName from sys_menu A left join sys_menu B on B.MenuCode = A.ParentCode order by A.MenuSeq,A.MenuCode
2013-09-10 11:30:40,202 [10716] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Sys/menu/Index','/Sys/menu')
2013-09-10 11:30:41,323 [9744] DEBUG Servicesys_menu - 获取动态列表
2013-09-10 11:30:41,323 [9744] DEBUG Sys - select A.*,B.MenuName as ParentName from sys_menu A left join sys_menu B on B.MenuCode = A.ParentCode order by A.MenuSeq,A.MenuCode
2013-09-10 11:31:25,866 [11832] DEBUG Servicesys_menu - 编辑记录
2013-09-10 11:31:25,897 [11832] DEBUG Servicesys_menu - 获取动态对象
2013-09-10 11:31:25,915 [11832] DEBUG Sys - select 
        sys_menu
    .* from 
        sys_menu
     where  MenuCode =  'c605c038-e36c-47b0-90d7-9ba44fcc8c73'
2013-09-10 11:31:25,932 [11832] DEBUG Sys - insert into 
        sys_menu
    ([MenuName],[MenuCode],[ParentCode],[IconClass],[URL],[IsVisible],[IsEnable],[MenuSeq],[UpdatePerson],[UpdateDate],[CreatePerson],[CreateDate]) values('测试1','9950','98','icon-application_cascade','/mms/liy','true','true','','刘会胜','2013-09-10 11:31:25','刘会胜','2013-09-10 11:31:25')
2013-09-10 11:31:25,965 [11832] DEBUG Sys - insert into sys_log([UserCode],[UserName],[Position],[Target],[Type],[Message],[Date]) values('lhs','刘会胜','api/mms/send','菜单数据','修改','{"list":{"deleted":[],"inserted":[{"_id":"c605c038-e36c-47b0-90d7-9ba44fcc8c73","MenuName":"测试1","MenuCode":"9950","ParentCode":"98","IconClass":"icon-application_cascade","URL":"/mms/liy","IsVisible":"true","IsEnable":"true","MenuSeq":""}],"updated":[],"_changed":true}}','2013-09-10 11:31:25')
2013-09-10 11:31:26,149 [2600] DEBUG Servicesys_menu - 获取动态列表
2013-09-10 11:31:26,150 [2600] DEBUG Sys - select A.*,B.MenuName as ParentName from sys_menu A left join sys_menu B on B.MenuCode = A.ParentCode order by A.MenuSeq,A.MenuCode
2013-09-10 11:31:32,594 [12832] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Sys/role/Index','/Sys/role')
2013-09-10 11:31:32,598 [12832] DEBUG Servicesys_user - 获取动态列表
2013-09-10 11:31:32,599 [12832] DEBUG Sys - select UserCode,UserName from sys_user
2013-09-10 11:31:32,599 [12832] DEBUG Servicesys_organize - 获取动态列表
2013-09-10 11:31:32,600 [12832] DEBUG Sys - select OrganizeCode,OrganizeName from sys_organize
2013-09-10 11:31:33,705 [12176] DEBUG Servicesys_role - 获取实体列表
2013-09-10 11:31:33,711 [12176] DEBUG Sys - select sys_role.* from sys_role order by RoleSeq
2013-09-10 11:31:35,242 [12832] DEBUG Sys - select * from sys_button order by ButtonSeq
2013-09-10 11:31:35,246 [2600] DEBUG Servicesys_permission - 获取动态列表
2013-09-10 11:31:35,247 [2600] DEBUG Sys - select A.*
,case when B.PermissionCode is null then 0 else 1           end as checked
,case when B.PermissionCode is null then 0 else B.IsDefault end as IsDefault from sys_permission A
left join sys_rolePermissionMap B on B.RoleCode='super' and B.PermissionCode = A.PermissionCode 
2013-09-10 11:31:35,247 [12832] DEBUG Sys - select A.MenuName,A.MenuCode,A.ParentCode,A.IconClass as iconCls,B.MenuName as ParentName,(select 1 from sys_roleMenuMap tb_role where tb_role.RoleCode='super' and tb_role.MenuCode=A.MenuCode) as checked,(
select case when max(tb1_add.ID) is null then -1 
            when max(tb2_add.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_add
left join sys_roleMenuButtonMap AS tb2_add ON tb2_add.MenuCode=tb1_add.MenuCode AND tb2_add.ButtonCode=tb1_add.ButtonCode AND tb2_add.RoleCode='super'
where tb1_add.MenuCode = A.MenuCode and  tb1_add.ButtonCode = 'add'  
)as 'btn_add' ,(
select case when max(tb1_browse.ID) is null then -1 
            when max(tb2_browse.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_browse
left join sys_roleMenuButtonMap AS tb2_browse ON tb2_browse.MenuCode=tb1_browse.MenuCode AND tb2_browse.ButtonCode=tb1_browse.ButtonCode AND tb2_browse.RoleCode='super'
where tb1_browse.MenuCode = A.MenuCode and  tb1_browse.ButtonCode = 'browse'  
)as 'btn_browse' ,(
select case when max(tb1_edit.ID) is null then -1 
            when max(tb2_edit.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_edit
left join sys_roleMenuButtonMap AS tb2_edit ON tb2_edit.MenuCode=tb1_edit.MenuCode AND tb2_edit.ButtonCode=tb1_edit.ButtonCode AND tb2_edit.RoleCode='super'
where tb1_edit.MenuCode = A.MenuCode and  tb1_edit.ButtonCode = 'edit'  
)as 'btn_edit' ,(
select case when max(tb1_delete.ID) is null then -1 
            when max(tb2_delete.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_delete
left join sys_roleMenuButtonMap AS tb2_delete ON tb2_delete.MenuCode=tb1_delete.MenuCode AND tb2_delete.ButtonCode=tb1_delete.ButtonCode AND tb2_delete.RoleCode='super'
where tb1_delete.MenuCode = A.MenuCode and  tb1_delete.ButtonCode = 'delete'  
)as 'btn_delete' ,(
select case when max(tb1_search.ID) is null then -1 
            when max(tb2_search.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_search
left join sys_roleMenuButtonMap AS tb2_search ON tb2_search.MenuCode=tb1_search.MenuCode AND tb2_search.ButtonCode=tb1_search.ButtonCode AND tb2_search.RoleCode='super'
where tb1_search.MenuCode = A.MenuCode and  tb1_search.ButtonCode = 'search'  
)as 'btn_search' ,(
select case when max(tb1_refresh.ID) is null then -1 
            when max(tb2_refresh.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_refresh
left join sys_roleMenuButtonMap AS tb2_refresh ON tb2_refresh.MenuCode=tb1_refresh.MenuCode AND tb2_refresh.ButtonCode=tb1_refresh.ButtonCode AND tb2_refresh.RoleCode='super'
where tb1_refresh.MenuCode = A.MenuCode and  tb1_refresh.ButtonCode = 'refresh'  
)as 'btn_refresh' ,(
select case when max(tb1_export.ID) is null then -1 
            when max(tb2_export.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_export
left join sys_roleMenuButtonMap AS tb2_export ON tb2_export.MenuCode=tb1_export.MenuCode AND tb2_export.ButtonCode=tb1_export.ButtonCode AND tb2_export.RoleCode='super'
where tb1_export.MenuCode = A.MenuCode and  tb1_export.ButtonCode = 'export'  
)as 'btn_export' ,(
select case when max(tb1_download.ID) is null then -1 
            when max(tb2_download.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_download
left join sys_roleMenuButtonMap AS tb2_download ON tb2_download.MenuCode=tb1_download.MenuCode AND tb2_download.ButtonCode=tb1_download.ButtonCode AND tb2_download.RoleCode='super'
where tb1_download.MenuCode = A.MenuCode and  tb1_download.ButtonCode = 'download'  
)as 'btn_download' ,(
select case when max(tb1_print.ID) is null then -1 
            when max(tb2_print.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_print
left join sys_roleMenuButtonMap AS tb2_print ON tb2_print.MenuCode=tb1_print.MenuCode AND tb2_print.ButtonCode=tb1_print.ButtonCode AND tb2_print.RoleCode='super'
where tb1_print.MenuCode = A.MenuCode and  tb1_print.ButtonCode = 'print'  
)as 'btn_print' ,(
select case when max(tb1_accredit.ID) is null then -1 
            when max(tb2_accredit.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_accredit
left join sys_roleMenuButtonMap AS tb2_accredit ON tb2_accredit.MenuCode=tb1_accredit.MenuCode AND tb2_accredit.ButtonCode=tb1_accredit.ButtonCode AND tb2_accredit.RoleCode='super'
where tb1_accredit.MenuCode = A.MenuCode and  tb1_accredit.ButtonCode = 'accredit'  
)as 'btn_accredit' ,(
select case when max(tb1_audit.ID) is null then -1 
            when max(tb2_audit.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_audit
left join sys_roleMenuButtonMap AS tb2_audit ON tb2_audit.MenuCode=tb1_audit.MenuCode AND tb2_audit.ButtonCode=tb1_audit.ButtonCode AND tb2_audit.RoleCode='super'
where tb1_audit.MenuCode = A.MenuCode and  tb1_audit.ButtonCode = 'audit'  
)as 'btn_audit' ,(
select case when max(tb1_inport.ID) is null then -1 
            when max(tb2_inport.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_inport
left join sys_roleMenuButtonMap AS tb2_inport ON tb2_inport.MenuCode=tb1_inport.MenuCode AND tb2_inport.ButtonCode=tb1_inport.ButtonCode AND tb2_inport.RoleCode='super'
where tb1_inport.MenuCode = A.MenuCode and  tb1_inport.ButtonCode = 'inport'  
)as 'btn_inport' ,(
select case when max(tb1_copy.ID) is null then -1 
            when max(tb2_copy.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_copy
left join sys_roleMenuButtonMap AS tb2_copy ON tb2_copy.MenuCode=tb1_copy.MenuCode AND tb2_copy.ButtonCode=tb1_copy.ButtonCode AND tb2_copy.RoleCode='super'
where tb1_copy.MenuCode = A.MenuCode and  tb1_copy.ButtonCode = 'copy'  
)as 'btn_copy' ,(
select case when max(tb1_save.ID) is null then -1 
            when max(tb2_save.ID) is null then 0 
            else 1 end 
from  sys_menuButtonMap AS tb1_save
left join sys_roleMenuButtonMap AS tb2_save ON tb2_save.MenuCode=tb1_save.MenuCode AND tb2_save.ButtonCode=tb1_save.ButtonCode AND tb2_save.RoleCode='super'
where tb1_save.MenuCode = A.MenuCode and  tb1_save.ButtonCode = 'save'  
)as 'btn_save' 
from sys_menu as A
left join sys_menu B on B.MenuCode = A.ParentCode
where A.IsEnable = 1
order by A.MenuSeq,A.MenuCode
2013-09-10 11:31:35,307 [12832] DEBUG Sys - select * from sys_roleMenuColumnMap where RoleCode = 'super'
2013-09-10 11:31:57,620 [11832] DEBUG Servicesys_role - 修改角色菜单权限
2013-09-10 11:31:57,624 [11832] DEBUG Sys - delete from sys_roleMenuMap where [RoleCode] = 'super'
2013-09-10 11:31:57,648 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','10')
2013-09-10 11:31:57,651 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9930')
2013-09-10 11:31:57,654 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1002')
2013-09-10 11:31:57,654 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1001')
2013-09-10 11:31:57,655 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1009')
2013-09-10 11:31:57,655 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1010')
2013-09-10 11:31:57,656 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1013')
2013-09-10 11:31:57,656 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1007')
2013-09-10 11:31:57,657 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1006')
2013-09-10 11:31:57,657 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1011')
2013-09-10 11:31:57,658 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1003')
2013-09-10 11:31:57,658 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1012')
2013-09-10 11:31:57,659 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1008')
2013-09-10 11:31:57,659 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1005')
2013-09-10 11:31:57,660 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1004')
2013-09-10 11:31:57,660 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','100101')
2013-09-10 11:31:57,663 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','100201')
2013-09-10 11:31:57,664 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','100312')
2013-09-10 11:31:57,664 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','100401')
2013-09-10 11:31:57,665 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','100501')
2013-09-10 11:31:57,665 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','100601')
2013-09-10 11:31:57,666 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','100701')
2013-09-10 11:31:57,666 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','100801')
2013-09-10 11:31:57,667 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','100901')
2013-09-10 11:31:57,667 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','101001')
2013-09-10 11:31:57,668 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','101101')
2013-09-10 11:31:57,668 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','101201')
2013-09-10 11:31:57,669 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','101301')
2013-09-10 11:31:57,669 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','11')
2013-09-10 11:31:57,670 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1105')
2013-09-10 11:31:57,670 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1101')
2013-09-10 11:31:57,671 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1102')
2013-09-10 11:31:57,671 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1103')
2013-09-10 11:31:57,672 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1104')
2013-09-10 11:31:57,672 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1109')
2013-09-10 11:31:57,673 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','03')
2013-09-10 11:31:57,673 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','0301')
2013-09-10 11:31:57,674 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','0302')
2013-09-10 11:31:57,674 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','0303')
2013-09-10 11:31:57,675 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','0304')
2013-09-10 11:31:57,675 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','12')
2013-09-10 11:31:57,676 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1204')
2013-09-10 11:31:57,676 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1201')
2013-09-10 11:31:57,677 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1202')
2013-09-10 11:31:57,677 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','1203')
2013-09-10 11:31:57,678 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','99')
2013-09-10 11:31:57,678 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9902')
2013-09-10 11:31:57,679 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9903')
2013-09-10 11:31:57,680 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9910')
2013-09-10 11:31:57,680 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9904')
2013-09-10 11:31:57,681 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9905')
2013-09-10 11:31:57,681 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9906')
2013-09-10 11:31:57,682 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9911')
2013-09-10 11:31:57,682 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9907')
2013-09-10 11:31:57,683 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','98')
2013-09-10 11:31:57,683 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9810')
2013-09-10 11:31:57,684 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9915')
2013-09-10 11:31:57,684 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9920')
2013-09-10 11:31:57,685 [11832] DEBUG Sys - insert into sys_roleMenuMap([RoleCode],[MenuCode]) values('super','9950')
2013-09-10 11:31:57,726 [11832] DEBUG Servicesys_role - 修改角色菜单按钮权限
2013-09-10 11:31:57,728 [11832] DEBUG Sys - delete from sys_roleMenuButtonMap where [RoleCode] = 'super'
2013-09-10 11:31:57,730 [11832] DEBUG Sys - insert into sys_roleMenuButtonMap([RoleCode],[MenuCode],[ButtonCode]) values('super','1001','add')
2013-09-10 11:31:57,734 [11832] DEBUG Sys - insert into sys_roleMenuButtonMap([RoleCode],[MenuCode],[ButtonCode]) values('super','1001','edit')
2013-09-10 11:31:57,737 [11832] DEBUG Sys - insert into sys_roleMenuButtonMap([RoleCode],[MenuCode],[ButtonCode]) values('super','1001','delete')
2013-09-10 11:31:57,740 [11832] DEBUG Sys - insert into sys_roleMenuButtonMap([RoleCode],[MenuCode],[ButtonCode]) values('super','1001','refresh')
2013-09-10 11:31:57,743 [11832] DEBUG Sys - insert into sys_roleMenuButtonMap([RoleCode],[MenuCode],[ButtonCode]) values('super','1001','download')
2013-09-10 11:31:57,746 [11832] DEBUG Sys - insert into sys_roleMenuButtonMap([RoleCode],[MenuCode],[ButtonCode]) values('super','1001','audit')
2013-09-10 11:31:57,787 [11832] DEBUG Servicesys_role - 修改角色数据权限
2013-09-10 11:31:57,789 [11832] DEBUG Sys - delete from sys_rolePermissionMap where [RoleCode] = 'super'
2013-09-10 11:31:57,791 [11832] DEBUG Sys - insert into sys_rolePermissionMap([RoleCode],[PermissionCode],[IsDefault]) values('super','0102','0')
2013-09-10 11:31:57,836 [11832] DEBUG Servicesys_role - 修改角色数据列权限
2013-09-10 11:31:57,840 [11832] DEBUG Sys - delete from sys_roleMenuColumnMap where [RoleCode] = 'super'
2013-09-10 11:31:57,843 [11832] DEBUG Sys - insert into sys_roleMenuColumnMap([RoleCode],[MenuCode],[IsReject],[FieldName]) values('super','1001','True','BillNo')
2013-09-10 11:31:59,346 [12176] DEBUG Sys - select * from sys_userSetting where UserCode='lhs'
2013-09-10 11:31:59,611 [10300] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'lhs' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'lhs'
  )  
)
order by B.MenuSeq,B.MenuCode
2013-09-10 11:32:00,143 [11832] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Sys/role/Index','/Sys/role')
2013-09-10 11:32:00,146 [11832] DEBUG Servicesys_user - 获取动态列表
2013-09-10 11:32:00,146 [11832] DEBUG Sys - select UserCode,UserName from sys_user
2013-09-10 11:32:00,147 [11832] DEBUG Servicesys_organize - 获取动态列表
2013-09-10 11:32:00,147 [11832] DEBUG Sys - select OrganizeCode,OrganizeName from sys_organize
2013-09-10 11:32:00,599 [12832] DEBUG Servicesys_role - 获取实体列表
2013-09-10 11:32:00,600 [12832] DEBUG Sys - select sys_role.* from sys_role order by RoleSeq
2013-09-10 11:32:02,889 [9264] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Mms/liy/Index','/Mms/liy')
2013-09-10 11:32:02,901 [9264] DEBUG Servicesys_code - 获取动态列表
2013-09-10 11:32:02,902 [9264] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'Pricing'
2013-09-10 11:32:04,374 [10300] DEBUG Servicetest_liy - 获取动态列表
2013-09-10 11:32:04,375 [10300] DEBUG Mms - select top 20 * from test_liy order by ID
2013-09-10 11:32:04,438 [10300] DEBUG Mms - select count(*) from ( select * from test_liy ) tb_temp
2013-09-10 11:32:14,977 [5744] DEBUG Servicetest_liy - 获取新主键
2013-09-10 11:32:14,979 [5744] DEBUG Mms - select isnull(max(ID),0) from test_liy  where 1 = 1 
2013-09-10 11:32:40,633 [12176] DEBUG Servicetest_liy - 编辑记录
2013-09-10 11:32:40,634 [12176] DEBUG Servicetest_liy - 获取动态对象
2013-09-10 11:32:40,635 [12176] DEBUG Mms - select 
        test_liy
    .* from 
        test_liy
     where  ID =  '000001'
2013-09-10 11:32:40,638 [12176] DEBUG Mms - insert into 
        test_liy
    ([ID],[DepartmentID],[IsValid],[OutDateTime],[ApproveState],[ApprovePerson],[ApproveDate],[ApproveRemark],[Remark],[UpdatePerson],[UpdateDate],[CreatePerson],[CreateDate]) values('000001','aaa','','2013-09-03','','ffff','','ddddd','','刘会胜','2013-09-10 11:32:40','刘会胜','2013-09-10 11:32:40')
2013-09-10 11:32:41,013 [12176] ERROR Servicetest_liy - 编辑记录失败
System.Data.SqlClient.SqlException (0x80131904): 在将 nvarchar 值 'aaa' 转换成数据类型 int 时失败。
   在 Zephyr.Data.ExecuteQueryHandler.HandleQueryException(Exception exception) 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Net\Zephyr.Data\Command\Handlers\ExecuteQueryHandler.cs:行号 107
   在 Zephyr.Data.ExecuteQueryHandler.ExecuteQuery(Boolean useReader, Action action) 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Net\Zephyr.Data\Command\Handlers\ExecuteQueryHandler.cs:行号 28
   在 Zephyr.Data.DbCommand.Execute() 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Net\Zephyr.Data\Command\PartialClasses\Execute.cs:行号 9
   在 Zephyr.Data.BaseInsertBuilder.Execute() 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Net\Zephyr.Data\Builders\Insert\BaseInsertBuilder.cs:行号 22
   在 Zephyr.Core.ServiceBase`1.<Edit>b__3c(RequestWrapper x) 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Net\Zephyr.Core\Base\ServiceBaseEdit.cs:行号 62
   在 Zephyr.Core.ServiceBase`1.<>c__DisplayClass40.<Edit>b__3d() 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Net\Zephyr.Core\Base\ServiceBaseEdit.cs:行号 119
   在 Zephyr.Core.LogHelper.Logger(ILog log, String function, ErrorHandle errorHandleType, Action tryHandle, Action`1 catchHandle, Action finallyHandle) 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Net\Zephyr.Core\Logs\LogHelper.cs:行号 44
ClientConnectionId:1fa7ba48-b158-48a9-b3d8-d1377bf5e628
2013-09-10 11:32:45,404 [12176] ERROR /api/Mms/Liy/edit - System.Data.SqlClient.SqlException (0x80131904): 在将 nvarchar 值 'aaa' 转换成数据类型 int 时失败。
   在 Zephyr.Core.LogHelper.Logger(ILog log, String function, ErrorHandle errorHandleType, Action tryHandle, Action`1 catchHandle, Action finallyHandle) 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Net\Zephyr.Core\Logs\LogHelper.cs:行号 54
   在 Zephyr.Core.ServiceBase`1.Logger(String function, Action tryHandle, Action`1 catchHandle, Action finallyHandle) 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Net\Zephyr.Core\Base\ServiceBaseLog.cs:行号 23
   在 Zephyr.Core.ServiceBase`1.Edit(RequestWrapper formWrapper, RequestWrapper listWrapper, JObject data) 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Net\Zephyr.Core\Base\ServiceBaseEdit.cs:行号 68
   在 CallSite.Target(Closure , CallSite , test_liyService , Object , RequestWrapper , Object )
   在 System.Dynamic.UpdateDelegates.UpdateAndExecute4[T0,T1,T2,T3,TRet](CallSite site, T0 arg0, T1 arg1, T2 arg2, T3 arg3)
   在 Zephyr.Areas.Mms.Controllers.LiyApiController.Edit(Object data) 位置 g:\02.进行项目\纵云框架产品\Zephyr.Web-原始版\Zephyr.Web\Areas\Mms\Controllers\LiyController.cs:行号 93
   在 lambda_method(Closure , Object , Object[] )
   在 System.Web.Http.Controllers.ReflectedHttpActionDescriptor.ActionExecutor.<>c__DisplayClassf.<GetExecutor>b__9(Object instance, Object[] methodParameters)
   在 System.Web.Http.Controllers.ReflectedHttpActionDescriptor.ActionExecutor.Execute(Object instance, Object[] arguments)
   在 System.Web.Http.Controllers.ReflectedHttpActionDescriptor.<>c__DisplayClass5.<ExecuteAsync>b__4()
   在 System.Threading.Tasks.TaskHelpers.RunSynchronously[TResult](Func`1 func, CancellationToken cancellationToken)
ClientConnectionId:1fa7ba48-b158-48a9-b3d8-d1377bf5e628
2013-09-10 11:32:52,681 [5744] DEBUG Servicetest_liy - 编辑记录
2013-09-10 11:32:52,681 [5744] DEBUG Servicetest_liy - 获取动态对象
2013-09-10 11:32:52,682 [5744] DEBUG Mms - select 
        test_liy
    .* from 
        test_liy
     where  ID =  '000001'
2013-09-10 11:32:52,683 [5744] DEBUG Mms - insert into 
        test_liy
    ([ID],[DepartmentID],[IsValid],[OutDateTime],[ApproveState],[ApprovePerson],[ApproveDate],[ApproveRemark],[Remark],[UpdatePerson],[UpdateDate],[CreatePerson],[CreateDate]) values('000001','123','','2013-09-03','','ffff','','ddddd','','刘会胜','2013-09-10 11:32:52','刘会胜','2013-09-10 11:32:52')
2013-09-10 11:37:29,451 [9264] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Sys/generator/Index','/Sys/generator')
2013-09-10 11:38:28,609 [7344] DEBUG Mms - SELECT Name as TableName FROM sys.tables order by Name
2013-09-10 11:38:28,626 [9744] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('undefined')
ORDER BY sys.columns.column_id
2013-09-10 11:38:29,519 [9264] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_direct')
ORDER BY sys.columns.column_id
2013-09-10 11:38:34,529 [7344] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_direct')
ORDER BY sys.columns.column_id
2013-09-10 11:38:35,075 [11208] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_direct')
ORDER BY sys.columns.column_id
2013-09-10 11:38:36,167 [9264] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_directDetail')
ORDER BY sys.columns.column_id
2013-09-10 11:38:37,411 [9264] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_direct')
ORDER BY sys.columns.column_id
2013-09-10 11:38:41,565 [12852] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_directDetail')
ORDER BY sys.columns.column_id
2013-09-10 12:21:24,186 [3172] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_rentOutDetail')
ORDER BY sys.columns.column_id
2013-09-10 12:21:43,015 [1424] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_rentOutRepaire')
ORDER BY sys.columns.column_id
2013-09-10 12:23:21,646 [6708] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:21,647 [6708] DEBUG Mms - select top 20 
        *
     from 
        test_user
     order by UserCode
2013-09-10 12:23:21,693 [6708] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:23,157 [1424] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:23,158 [1424] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 21 and 40
2013-09-10 12:23:23,159 [1424] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:23,686 [12816] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:23,686 [12816] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 41 and 60
2013-09-10 12:23:23,688 [12816] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:24,206 [12644] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:24,207 [12644] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 61 and 80
2013-09-10 12:23:24,211 [12644] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:24,623 [3172] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:24,623 [3172] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 81 and 100
2013-09-10 12:23:24,627 [3172] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:24,974 [8088] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:24,974 [8088] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 101 and 120
2013-09-10 12:23:24,979 [8088] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:25,367 [12816] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:25,367 [12816] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 121 and 140
2013-09-10 12:23:25,372 [12816] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:25,715 [12644] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:25,715 [12644] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 141 and 160
2013-09-10 12:23:25,720 [12644] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:26,061 [3172] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:26,062 [3172] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 161 and 180
2013-09-10 12:23:26,066 [3172] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:26,438 [12816] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:26,438 [12816] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 181 and 200
2013-09-10 12:23:26,442 [12816] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:26,826 [3172] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:26,826 [3172] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 201 and 220
2013-09-10 12:23:26,831 [3172] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:27,247 [8088] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:27,248 [8088] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 221 and 240
2013-09-10 12:23:27,254 [8088] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:27,708 [3172] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:27,708 [3172] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 241 and 260
2013-09-10 12:23:27,713 [3172] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:28,211 [11744] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:28,211 [11744] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 261 and 280
2013-09-10 12:23:28,216 [11744] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:28,349 [1424] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:28,349 [1424] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 281 and 300
2013-09-10 12:23:28,354 [1424] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:28,729 [11744] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:28,729 [11744] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 301 and 320
2013-09-10 12:23:28,734 [11744] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:53,306 [11744] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:53,306 [11744] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 321 and 340
2013-09-10 12:23:53,311 [11744] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:53,681 [7752] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:53,682 [7752] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 281 and 300
2013-09-10 12:23:53,683 [7752] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:53,993 [11744] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:53,993 [11744] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 321 and 340
2013-09-10 12:23:53,995 [11744] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:54,617 [7752] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:54,617 [7752] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 341 and 360
2013-09-10 12:23:54,622 [7752] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:55,204 [11744] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:55,204 [11744] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 361 and 380
2013-09-10 12:23:55,208 [11744] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:55,646 [7752] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:55,646 [7752] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 381 and 400
2013-09-10 12:23:55,651 [7752] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:57,806 [7752] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:57,807 [7752] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 1301 and 1320
2013-09-10 12:23:57,813 [7752] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:57,922 [11744] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:57,922 [11744] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 1321 and 1340
2013-09-10 12:23:57,929 [11744] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:58,580 [12816] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:58,580 [12816] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 1341 and 1360
2013-09-10 12:23:58,586 [12816] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:59,292 [6708] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:59,292 [6708] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 1361 and 1380
2013-09-10 12:23:59,298 [6708] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:23:59,822 [8088] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:23:59,822 [8088] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 1381 and 1400
2013-09-10 12:23:59,828 [8088] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:00,377 [12644] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:00,377 [12644] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 1401 and 1420
2013-09-10 12:24:00,383 [12644] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:00,892 [6708] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:00,893 [6708] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 1421 and 1440
2013-09-10 12:24:00,900 [6708] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:02,053 [7752] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:02,053 [7752] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 2081 and 2100
2013-09-10 12:24:02,060 [7752] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:02,184 [11744] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:02,184 [11744] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 2101 and 2120
2013-09-10 12:24:02,191 [11744] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:03,527 [11744] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:03,528 [11744] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 2381 and 2400
2013-09-10 12:24:03,535 [11744] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:03,652 [1424] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:03,652 [1424] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 2401 and 2420
2013-09-10 12:24:03,659 [1424] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:03,769 [8028] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:03,769 [8028] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 2421 and 2440
2013-09-10 12:24:03,776 [8028] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:05,050 [8028] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:05,050 [8028] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 2521 and 2540
2013-09-10 12:24:05,056 [8028] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:05,226 [12644] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:05,226 [12644] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 2561 and 2580
2013-09-10 12:24:05,233 [12644] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:05,402 [12180] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:05,402 [12180] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 2601 and 2620
2013-09-10 12:24:05,409 [12180] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:05,556 [7752] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:05,557 [7752] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 2621 and 2640
2013-09-10 12:24:05,564 [7752] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:05,679 [11744] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:05,679 [11744] DEBUG Mms - with PagedPersons as
								(
									select top 100 percent 
        *
    , row_number() over (order by UserCode) as FLUENTDATA_ROWNUMBER
									 from 
        test_user
    
								)
								select *
								from PagedPersons
								where fluentdata_RowNumber between 2641 and 2660
2013-09-10 12:24:05,686 [11744] DEBUG Mms - select count(*) from ( select 
        *
     from 
        test_user
     ) tb_temp
2013-09-10 12:24:14,605 [12644] DEBUG Servicemms_send - 获取动态列表
2013-09-10 12:24:14,606 [12644] DEBUG Mms - select 
        *
     from 
        test_user
     order by UserCode
2013-09-10 15:33:18,830 [11276] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Sys/organize/Index','/Sys/organize')
2013-09-10 15:33:18,839 [11276] DEBUG Servicesys_organize - 获取实体列表
2013-09-10 15:33:18,839 [11276] DEBUG Sys - select sys_organize.* from sys_organize
2013-09-10 15:34:17,794 [9348] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Mms/report/balanceaccount')
2013-09-10 15:34:17,805 [9348] DEBUG Servicemms_warehouse - 获取动态列表
2013-09-10 15:34:17,811 [9348] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2013-09-10 15:34:17,812 [9348] DEBUG Servicemms_buildPart - 获取动态列表
2013-09-10 15:34:17,813 [9348] DEBUG Mms - select BuildPartCode as value,BuildPartName as text from mms_buildPart where  ProjectCode =  '201306030001'
2013-09-10 15:34:18,974 [5764] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2013-09-10 15:34:19,119 [5764] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Money else 0 end),0) as PickUnitMoney0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum1 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney1                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2013-09-10 15:34:19,369 [5764] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2013-09-10 15:34:30,677 [5764] DEBUG Sys - select * from sys_userSetting where UserCode='lhs'
2013-09-10 15:34:31,102 [11048] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'lhs' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'lhs'
  )  
)
order by B.MenuSeq,B.MenuCode
2013-09-10 15:34:31,588 [4488] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Mms/report/balanceaccount')
2013-09-10 15:34:31,590 [4488] DEBUG Servicemms_warehouse - 获取动态列表
2013-09-10 15:34:31,590 [4488] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2013-09-10 15:34:31,590 [4488] DEBUG Servicemms_buildPart - 获取动态列表
2013-09-10 15:34:31,591 [4488] DEBUG Mms - select BuildPartCode as value,BuildPartName as text from mms_buildPart where  ProjectCode =  '201306030001'
2013-09-10 15:34:32,022 [8968] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2013-09-10 15:34:32,024 [8968] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Money else 0 end),0) as PickUnitMoney0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum1 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney1                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2013-09-10 15:34:32,029 [8968] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2013-09-10 15:35:30,870 [4488] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001' And mms_receive.WarehouseCode ='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001' And mms_return.WarehouseCode ='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001' And 1=0

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001' And 1=0

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001' And mms_stockAdjust.WarehouseCode ='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001' And mms_send.WarehouseCode ='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001' And mms_refund.WarehouseCode ='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001' And mms_transfer.WarehouseCode ='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001' And mms_lossReport.WarehouseCode ='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2013-09-10 15:35:30,936 [4488] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney0                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001' And mms_receive.WarehouseCode ='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001' And mms_return.WarehouseCode ='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001' And 1=0

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001' And 1=0

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001' And mms_stockAdjust.WarehouseCode ='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001' And mms_send.WarehouseCode ='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001' And mms_refund.WarehouseCode ='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001' And mms_transfer.WarehouseCode ='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001' And mms_lossReport.WarehouseCode ='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2013-09-10 15:35:31,028 [4488] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001' And mms_warehouseStockHistory.WarehouseCode ='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2013-09-10 15:35:32,770 [4488] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2013-09-10 15:35:32,772 [4488] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Money else 0 end),0) as PickUnitMoney0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum1 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney1                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2013-09-10 15:35:32,776 [4488] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2013-09-10 15:36:32,115 [12656] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Mms/productTest/Index','/Mms/productTest')
2013-09-10 15:36:32,121 [12656] DEBUG Servicesys_code - 获取动态列表
2013-09-10 15:36:32,122 [12656] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'Pricing'
2013-09-10 15:36:33,574 [3484] DEBUG Servicemms_productTest - 获取动态列表
2013-09-10 15:36:33,574 [3484] DEBUG Mms - select top 20 * from mms_productTest order by ID
2013-09-10 15:36:33,623 [3484] DEBUG Mms - select count(*) from ( select * from mms_productTest ) tb_temp
2013-09-10 15:36:40,933 [12656] DEBUG Servicemms_productTest - 获取新主键
2013-09-10 15:36:40,933 [12656] DEBUG Mms - select isnull(max(ID),0) from mms_productTest  where 1 = 1 
2013-09-10 17:11:13,242 [6948] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Sys/generator/Index','/Sys/generator')
2013-09-10 17:11:17,263 [9304] DEBUG Mms - SELECT Name as TableName FROM sys.tables order by Name
2013-09-10 17:11:17,268 [4556] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('undefined')
ORDER BY sys.columns.column_id
2013-09-10 17:11:18,444 [6948] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_deal')
ORDER BY sys.columns.column_id
2013-09-10 17:11:26,116 [3732] DEBUG Mms - 
SELECT	sys.columns.name						AS ColumnName, 
		type_name(sys.columns.system_type_id)	AS SqlTypeName,
		sys.columns.max_length					AS MaxLength,
		sys.columns.is_nullable					AS IsNullable,
		sys.columns.is_identity					AS IsIdentity,
		(case when exists(select 1  
						 from   syscolumns 
						 join   sysindexkeys on syscolumns.id  =sysindexkeys.id and syscolumns.colid=sysindexkeys.colid and syscolumns.id=sys.columns.object_id 
						 join   sysindexes   on syscolumns.id  =sysindexes.id   and sysindexkeys.indid=sysindexes.indid   
						 join   sysobjects   on sysindexes.name=sysobjects.name and sysobjects.xtype= 'PK '
						 where syscolumns.name = sys.columns.name) then 1 else 0 end) AS IsPrimaryKey,
		(select value from sys.extended_properties where sys.extended_properties.major_id = sys.columns.object_id and sys.extended_properties.minor_id = sys.columns.column_id) as Description
FROM sys.columns    
WHERE sys.columns.object_id = object_id('mms_deal')
ORDER BY sys.columns.column_id
2013-09-10 17:11:26,133 [3732] DEBUG Mms - sp_pkeys 'mms_deal'
2013-09-10 17:12:01,027 [2016] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Mms/receive/Index','/Mms/receive')
2013-09-10 17:12:01,037 [2016] DEBUG Servicemms_warehouse - 获取动态列表
2013-09-10 17:12:01,037 [2016] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2013-09-10 17:12:01,066 [2016] DEBUG Servicesys_code - 获取动态列表
2013-09-10 17:12:01,066 [2016] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2013-09-10 17:12:02,811 [10608] DEBUG Servicemms_receive - 获取动态列表
2013-09-10 17:12:02,811 [10608] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2013-09-10 17:12:02,852 [10608] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' ) tb_temp
2013-09-10 17:12:03,633 [6444] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Mms/receive/edit')
2013-09-10 17:12:03,652 [6444] DEBUG Servicemms_receive - 获取实体对象
2013-09-10 17:12:03,653 [6444] DEBUG Mms - select mms_receive.* from mms_receive where  BillNo =  '201307020002'
2013-09-10 17:12:03,661 [6444] DEBUG Servicemms_receive - 获取上一条下一条数据
2013-09-10 17:12:03,690 [6444] DEBUG Servicemms_receive - 获取字段
2013-09-10 17:12:03,692 [6444] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo
2013-09-10 17:12:03,694 [6444] DEBUG Servicemms_receive - 获取字段
2013-09-10 17:12:03,695 [6444] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo < '201307020002'and ProjectCode =  '201306030001' order by BillNo desc
2013-09-10 17:12:03,697 [6444] DEBUG Servicemms_receive - 获取字段
2013-09-10 17:12:03,698 [6444] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo >  '201307020002'and ProjectCode =  '201306030001' order by BillNo
2013-09-10 17:12:03,700 [6444] DEBUG Servicemms_receive - 获取字段
2013-09-10 17:12:03,700 [6444] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo desc
2013-09-10 17:12:03,736 [6444] DEBUG Servicesys_code - 获取动态列表
2013-09-10 17:12:03,736 [6444] DEBUG Sys - select Text as value,Text as text from sys_code where  CodeType =  'MeasureUnit'
2013-09-10 17:12:03,738 [6444] DEBUG Servicesys_code - 获取动态列表
2013-09-10 17:12:03,738 [6444] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2013-09-10 17:12:03,738 [6444] DEBUG Servicesys_code - 获取动态列表
2013-09-10 17:12:03,738 [6444] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'PayType'
2013-09-10 17:12:03,739 [6444] DEBUG Servicemms_warehouse - 获取动态列表
2013-09-10 17:12:03,739 [6444] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2013-09-10 17:12:03,741 [6444] DEBUG Servicesys_code - 获取字段
2013-09-10 17:12:03,741 [6444] DEBUG Sys - select top 1 Code from sys_code where  CodeType =  'SupplyType'and IsEnable =  'True'and IsDefault =  'True'
2013-09-10 17:12:03,743 [6444] DEBUG Servicesys_code - 获取字段
2013-09-10 17:12:03,743 [6444] DEBUG Sys - select top 1 Code from sys_code where  CodeType =  'PayType'and IsEnable =  'True'and IsDefault =  'True'
2013-09-10 17:12:04,815 [9304] DEBUG ServiceModelBase - 获取动态列表
2013-09-10 17:12:04,816 [9304] DEBUG Mms - select 
    MerchantsCode   as   value,MerchantsName   as   text
   from 
    mms_merchants A
    left join mms_merchantsType B on B.MerchantsTypeCode = A.MerchantsTypeCode
   where  MerchantsCode in ('CG00303') order by MerchantsCode
2013-09-10 17:12:05,304 [11952] DEBUG Servicemms_receive - 获取动态列表
2013-09-10 17:12:05,305 [11952] DEBUG Mms - select 
        A.*, B.MaterialName,B.Model,B.Material
     from 
        mms_receiveDetail A
        left join mms_material B on B.MaterialCode = A.MaterialCode
     where  BillNo =  '201307020002' order by A.MaterialCode
2013-09-10 17:12:59,490 [4556] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'lhs'
and C.URL in ('/Mms/productTest/Index','/Mms/productTest')
2013-09-10 17:12:59,500 [4556] DEBUG Servicesys_code - 获取动态列表
2013-09-10 17:12:59,500 [4556] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'Pricing'
2013-09-10 17:12:59,973 [11952] DEBUG Servicemms_productTest - 获取动态列表
2013-09-10 17:12:59,973 [11952] DEBUG Mms - select top 20 * from mms_productTest order by ID
2013-09-10 17:12:59,991 [11952] DEBUG Mms - select count(*) from ( select * from mms_productTest ) tb_temp
